<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <input id="file" type="file" accept="image/*">
    <img id='image'>
    <script>
      uploadFile = blob => {
        let reader = new FileReader()
        reader.readAsDataURL(blob)
        reader.onload = e => document.getElementById('image')
                                     .setAttribute('src', e.target.result)
      }

      compress = (rawFile, type) => {
        reader = new FileReader()
        reader.onload = e => {
          let img = new Image()
          img.onload = e => {
            let size = 220,
                img = e.target,
                [width, height] = [img.width, img.height]
            if (width > height) [width, height] = [size, height*size/width]
            else [width, height] = [width*size/height, size]
            let canvas = document.createElement('canvas')
            canvas.width = width
            canvas.height = height
            canvas.getContext('2d').drawImage(img, 0, 0, width, height)
            canvas.toBlob(uploadFile, type, 1)
          }
          img.setAttribute('src', e.target.result)
        }
        reader.readAsDataURL(rawFile)
      }

      convertToBlob = (file, type) => {
        let blob = new Blob([file], {type: type})
        return blob
      }

      document.getElementById("file").addEventListener("change", e => {
        let rawFile = e.target.files[0]
        compress(rawFile)
        // compress(rawFile, type).uploadFile()
        // convertToBlob(rawFile, type).uploadFile()
      })
    </script>
  </body>
</html>